version: 1

project_name: vpn

before:
  hooks:
    - go mod tidy
    # 1. Build a temporary binary
    - go build -o /tmp/vpn-gen .
    # 2. Generate the completions (assuming your CLI prints them to stdout)
    - sh -c '/tmp/vpn-gen completion bash > completions.bash'
    - sh -c '/tmp/vpn-gen completion zsh > completions.zsh'
    - sh -c '/tmp/vpn-gen completion fish > completions.fish'
# 1. BUILD CONFIGURATION
builds:
  - env:
      - CGO_ENABLED=0
    goos:
      - darwin # macOS
      - linux  # Linux
    goarch:
      - amd64  # Intel
      - arm64  # Apple Silicon / ARM
    # This strips debug symbols to make the binary smaller
    ldflags:
      - -s -w
      - -X github.com/PraveenPrabhuT/qvpn/cmd.Version={{.Version}}


# 2. ARCHIVE CONFIGURATION (How the tar.gz looks)
archives:
  - format: tar.gz
    # The name of the file inside the zip (will just be "vpn")
    name_template: >-
      {{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}
    # Include your license/readme if you have them
    files:
      - README.md
      - completions.bash
      - completions.zsh
      - completions.fish

# 3. CHECKSUMS (For security)
checksum:
  name_template: 'checksums.txt'

# 4. HOMEBREW TAP CONFIGURATION (The Magic Part)
brews:
  - name: vpn # The formula name (brew install vpn)
    
    # Where to push the formula
    repository:
      owner: PraveenPrabhuT  # CHANGE THIS!
      name: homebrew-tap           # The repo name for your tap
      token: "{{ .Env.GORELEASER_TOKEN }}" # We will set this secret later

    directory: Formula
    # Description for Homebrew
    description: "The Byte-Smith's VPN Orchestrator"
    homepage: "https://github.com/PraveenPrabhuT/qvpn"
    license: "MIT"
    # Install instructions for Homebrew
    install: |
      bin.install "vpn"
      
      # Bash completions
      bash_completion.install "completions.bash" => "vpn"
      # Zsh completions (Must be renamed to _vpn)
      zsh_completion.install "completions.zsh" => "_vpn"
      # Fish completions
      fish_completion.install "completions.fish" => "vpn.fish"

    # A simple test to verify it installed correctly
    test: |
      system "#{bin}/vpn --help"